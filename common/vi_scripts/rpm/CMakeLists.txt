cmake_minimum_required ( VERSION 2.8 )
###| CMAKE FPGA RPM Packaging Target |###
#
# Jacob Alexander 2014-2015
#
###


###
# Project Setup
#

#| Required Variables
if ( NOT DEFINED FPGA_RBF_FILE )
	message ( SEND_ERROR "'FPGA_RBF_FILE' - .rbf file has not been specified..." )
endif ()
if ( NOT DEFINED PROJECT_NAME )
	message ( SEND_ERROR "'PROJECT_NAME' - Project name has not been specified..." )
endif ()
if ( NOT DEFINED SVN_COMMITDATE )
	message ( SEND_ERROR "'SVN_COMMITDATE' - SVN commit date has not been specified..." )
endif ()
if ( NOT DEFINED REGMAP_VERSION )
	message ( SEND_ERROR "'REGMAP_VERSION' - Regmap version date has not been specified..." )
endif ()
if ( NOT DEFINED RPM_PREFIX )
	message ( SEND_ERROR "'RPM_PREFIX' - RPM prefix has not been specified..." )
endif ()

string ( TIMESTAMP CMAKE_GEN_TIMESTAMP "Generated by CMake: %Y-%m-%d %H:%M:%S - DO NOT EDIT" )

#| Project
set ( PROJECT ${PROJECT_NAME} )
project( ${PROJECT} )



###
# Module Path Setup
#

list( APPEND CMAKE_MODULE_PATH "${CMAKE_SOURCE_DIR}" ) # Used to reference the modules in the cmake folder, "this" folder



###
# Regmap Version File
#

#| Generate version file using template
configure_file ( _regmap_versionDate.FPGA.txt regmap_versionDate.FPGA.txt )



###
# RPM Build Target
#

#| Configure RPM Support
include ( rpm )



###
# Installation
#

#| Install script files, used for RPM creation
install ( FILES
	${CMAKE_BINARY_DIR}/regmap_versionDate.FPGA.txt
        DESTINATION usr/local/vi/bin
)

#| Possibly multiple RBF files
foreach ( RBF_FILE ${FPGA_RBF_FILE} )
	get_filename_component ( ABS_FPGA_RBF_FILE ${CMAKE_BINARY_DIR}/../${RBF_FILE} ABSOLUTE )
	get_filename_component ( BASE_FPGA_RBF_NAME ${ABS_FPGA_RBF_FILE} NAME_WE )

	install ( FILES
		${ABS_FPGA_RBF_FILE}
		RENAME ${BASE_FPGA_RBF_NAME}-${SVN_COMMITDATE}.rbf
		DESTINATION usr/local/vi/bin
	)
endforeach ()

#| Setup RPM Dependencies
add_custom_target( ${PROJECT} ALL )

